meta:
  portal_url: "<completar>"
  requiere_vpn: true
  descripcion: "Buscar por DNI, abrir primer resultado, ir a Resumen de Facturación, seleccionar Cuenta financiera con saldo y abrir detalle"
  datos_entrada:
    - nombre: dni
      ejemplo: "2994****"

pasos:
  - id: abrir_buscador_desde_icono
    pantalla: "Home"
    proposito: "Abrir el buscador desde el ícono del teléfono amarillo (barra superior, centro)"
    localizar:
      alternativas:
        - tooltip: "Búsqueda"
        - aria_label: "Búsqueda"
        - role: "button"
          icono: "teléfono"
    accion: "click"
    esperar:
      tipo: "elemento_visible"
      objetivo:
        por_texto: "Encontrar Comunicante Búsqueda CIM"

  - id: seleccionar_pestaña_cliente
    pantalla: "Encontrar Comunicante Búsqueda CIM"
    proposito: "Usar la pestaña Cliente"
    localizar:
      role: "tab|radio"
      por_texto: "Cliente"
    accion: "select"

  - id: seleccionar_tipo_documento_dni
    pantalla: "Encontrar Comunicante Búsqueda CIM"
    proposito: "Elegir 'Documento Nacional Identidad'"
    localizar:
      role: "combobox"
      etiqueta: "Tipo de Documento"
    accion: "select"
    valor: "Documento Nacional Identidad"

  - id: ingresar_dni
    pantalla: "Encontrar Comunicante Búsqueda CIM"
    proposito: "Ingresar el número de documento"
    localizar:
      role: "textbox"
      etiqueta: "Número de Documento"
    accion: "type"
    valor: "{{dni}}"

  - id: ejecutar_busqueda
    pantalla: "Encontrar Comunicante Búsqueda CIM"
    proposito: "Lanzar la búsqueda"
    preferencia: "enter"
    alternativas:
      - tipo: "enter"
      - tipo: "click"
        localizar:
          por_texto: "Buscar ahora"
    esperar:
      tipo: "lista_cargada"
      objetivo:
        titulo_o_contenedor: "Búsqueda: Contacto y Suscripción"

  - id: ver_todo_si_hay
    pantalla: "Búsqueda: Contacto y Suscripción"
    proposito: "Mostrar todas las filas si la lista está paginada"
    condicion:
      existe:
        por_texto: "Ver todo"
    si_verdadero:
      localizar:
        por_texto: "Ver todo"
      accion: "click"
      esperar:
        tipo: "lista_actualizada"
    si_falso:
      continuar_con: "seleccionar_primer_resultado"

  - id: seleccionar_primer_resultado
    pantalla: "Búsqueda: Contacto y Suscripción"
    proposito: "Abrir SIEMPRE la primera fila de resultados"
    precondicion:
      verificar_filas:
        minimo: 1
        si_cero_continuar_con: "sin_resultados"
    localizar:
      lista:
        contenedor_por_titulo: "Búsqueda: Contacto y Suscripción"
        fila_indice: 0
        click_objetivo: "columna_enlace_principal"
    accion: "click"
    esperar:
      tipo: "navegacion"

  - id: sin_resultados
    pantalla: "Búsqueda: Contacto y Suscripción"
    proposito: "Caso sin resultados"
    salida:
      info_apartado: "Sin resultados"
      estado: "finalizado_sin_datos"

  - id: abrir_tab_resumen_facturacion
    pantalla: "Home de Interacción"
    proposito: "Ir a la pestaña Resumen de Facturación"
    localizar:
      role: "tab"
      por_texto: "Resumen de Facturación"
    accion: "select"
    esperar:
      tipo: "elemento_visible"
      objetivo:
        por_texto: "Entidades de facturación"

  - id: abrir_barra_opciones_resumen
    pantalla: "Home de Interacción > Resumen de Facturación"
    proposito: "Click en la barra amarilla (entre 'Perfil actual del cliente' y 'Entidades de facturación')"
    localizar:
      contexto:
        anclas:
          - por_texto: "Perfil actual del cliente"
          - por_texto: "Entidades de facturación"
      alternativas:
        - role: "button"
          estilo: "amarillo"
        - relativo_a: "Entidades de facturación"
          posicion: "arriba-inmediato"
    accion: "click"

  - id: seleccionar_entidad_cuenta_financiera
    pantalla: "Home de Interacción > Resumen de Facturación"
    proposito: "Seleccionar 'Cuenta financiera' en Entidades de facturación"
    localizar:
      tabla:
        titulo: "Entidades de facturación"
        fila_por_texto: "Cuenta financiera"
        control: "radio"
    accion: "select"
    esperar:
      tipo: "elemento_habilitado"
      objetivo:
        por_texto: "Mostrar lista"

  - id: mostrar_lista_cuenta_financiera
    pantalla: "Home de Interacción > Resumen de Facturación"
    proposito: "Ver la 'Lista de Cuenta financiera'"
    localizar:
      por_texto: "Mostrar lista"
    accion: "click"
    esperar:
      tipo: "tabla_visible"
      objetivo:
        titulo_o_contenedor: "Lista de Cuenta financiera"

  - id: seleccionar_cf_con_saldo
    pantalla: "Home de Interacción > Resumen de Facturación"
    proposito: "Elegir la cuenta financiera que tenga Saldo > 0"
    localizar:
      tabla:
        titulo: "Lista de Cuenta financiera"
        columnas:
          nombre: "Nombre de la cuenta financiera"   # es el enlace azul
          estado: "Estado de la cuenta financiera"
          saldo: "Saldo"
    seleccion:
      criterio: "saldo > 0"
      si_multiples: "tomar_primera_coincidencia"   # confirmar si preferís la mayor
      si_ninguna: "continuar_con:no_hay_cf_con_saldo"
    accion: "click_enlace_en_columna:nombre"
    esperar:
      tipo: "navegacion"
      objetivo:
        titulo_o_contenedor: "Ver Cuenta Financiera"

  - id: no_hay_cf_con_saldo
    pantalla: "Home de Interacción > Resumen de Facturación"
    proposito: "No se encontró CF con saldo; registrar y finalizar/volver según política"
    salida:
      info_apartado: "Sin CF con saldo"
      estado: "finalizado_sin_datos_cf"

  - id: validar_pantalla_ver_cuenta_financiera
    pantalla: "Ver Cuenta Financiera"
    proposito: "Confirmar que cargó el detalle de la CF"
    verificar:
      campos_clave:
        - etiqueta: "Nombre FA"
        - etiqueta: "Saldo"
        - etiqueta: "Estado de Cobranza"
    continuar_con: "pendiente_definir_extraccion_y_captura"