meta:
  portal_url: "<completar>"
  requiere_vpn: true
  descripcion: "Abrir buscador, seleccionar tipo de documento, ingresar DNI, buscar, abrir primer resultado y navegar a Resumen de Facturación"
  datos_entrada:
    - nombre: dni
      ejemplo: "2994****"

pasos:
  - id: abrir_buscador_desde_icono
    pantalla: "Home"
    proposito: "Abrir el buscador desde el ícono del teléfono amarillo (barra superior, centro)"
    localizar:
      alternativas:
        - tooltip: "Búsqueda"
        - aria_label: "Búsqueda"
        - role: "button"
          icono: "teléfono"
    accion: "click"
    esperar:
      tipo: "elemento_visible"
      objetivo:
        por_texto: "Encontrar Comunicante Búsqueda CIM"

  - id: seleccionar_pestaña_cliente
    pantalla: "Encontrar Comunicante Búsqueda CIM"
    proposito: "Usar la pestaña Cliente"
    localizar:
      role: "tab|radio"
      por_texto: "Cliente"
    accion: "select"

  - id: seleccionar_tipo_documento_dni
    pantalla: "Encontrar Comunicante Búsqueda CIM"
    proposito: "Elegir 'Documento Nacional Identidad'"
    localizar:
      role: "combobox"
      etiqueta: "Tipo de Documento"
    accion: "select"
    valor: "Documento Nacional Identidad"

  - id: ingresar_dni
    pantalla: "Encontrar Comunicante Búsqueda CIM"
    proposito: "Ingresar el número de documento"
    localizar:
      role: "textbox"
      etiqueta: "Número de Documento"
    accion: "type"
    valor: "{{dni}}"

  - id: ejecutar_busqueda
    pantalla: "Encontrar Comunicante Búsqueda CIM"
    proposito: "Lanzar la búsqueda"
    preferencia: "enter"
    alternativas:
      - tipo: "enter"
      - tipo: "click"
        localizar:
          por_texto: "Buscar ahora"
    esperar:
      tipo: "lista_cargada"
      objetivo:
        titulo_o_contenedor: "Búsqueda: Contacto y Suscripción"

  - id: ver_todo_si_hay
    pantalla: "Búsqueda: Contacto y Suscripción"
    proposito: "Mostrar todas las filas si la lista está paginada"
    condicion:
      existe:
        por_texto: "Ver todo"
    si_verdadero:
      localizar:
        por_texto: "Ver todo"
      accion: "click"
      esperar:
        tipo: "lista_actualizada"
    si_falso:
      continuar_con: "seleccionar_primer_resultado"

  - id: seleccionar_primer_resultado
    pantalla: "Búsqueda: Contacto y Suscripción"
    proposito: "Abrir SIEMPRE la primera fila de resultados"
    precondicion:
      verificar_filas:
        minimo: 1
        si_cero_continuar_con: "sin_resultados"
    localizar:
      lista:
        contenedor_por_titulo: "Búsqueda: Contacto y Suscripción"
        fila_indice: 0
        click_objetivo: "columna_enlace_principal"
    accion: "click"
    esperar:
      tipo: "navegacion"

  - id: sin_resultados
    pantalla: "Búsqueda: Contacto y Suscripción"
    proposito: "Manejar el caso sin resultados"
    notas: "Registrar que no hubo resultados para el DNI y terminar/volver según regla"
    salida:
      info_apartado: "Sin resultados"
      estado: "finalizado_sin_datos"

  - id: abrir_tab_resumen_facturacion
    pantalla: "Home de Interacción"
    proposito: "Navegar a la pestaña Resumen de Facturación"
    localizar:
      role: "tab"
      por_texto: "Resumen de Facturación"
    accion: "select"
    esperar:
      tipo: "elemento_visible"
      objetivo:
        por_texto: "Entidades de facturación"